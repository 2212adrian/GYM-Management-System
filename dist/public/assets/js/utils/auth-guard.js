(async function(){const r=await(async()=>{if(window.supabaseReady&&(await window.supabaseReady,window.supabaseClient))return window.supabaseClient;for(let e=0;e<20;e++){if(window.supabaseClient)return window.supabaseClient;await new Promise(a=>setTimeout(a,100))}return null})();if(!r)return;const l="/index.html",s="/pages/main.html",d="/pages/unauthorized.html",u=async e=>{try{if(window.wolfRouter){if(e===s){await window.wolfRouter.goToMain("dashboard",{replace:!0,seamless:!0});return}if(e===l){await window.wolfRouter.goToLogin({replace:!0,seamless:!0});return}}}catch(a){console.warn("Wolf OS Guard: Seamless redirect fallback ->",a)}window.location.replace(e)},n=window.location.pathname.toLowerCase(),o=n==="/"||n===""||n.endsWith("index.html")||n.endsWith("/index"),c=n.includes("/pages/main")||n.includes("/pages/dashboard")||n.includes("/pages/")&&!n.includes("unauthorized");async function w(){var t;const{data:{session:e}}=await r.auth.getSession(),a=e==null?void 0:e.user,i=a&&((t=a.user_metadata)==null?void 0:t.role)==="admin";if(o&&a&&i){console.log("Wolf OS Guard: Active session found. Forwarding..."),await u(s);return}if(c){if(!a){window.location.replace(`${d}?err=102`);return}if(!i){window.location.replace(`${d}?err=102`);return}}}await w(),r.auth.onAuthStateChange(async(e,a)=>{var i;if(console.log("Guard Event:",e),e==="SIGNED_IN"&&o){console.log("Wolf OS Guard: Sign-in detected. Deferring to auth.js for animation.");return}if(e==="INITIAL_SESSION"&&o){const t=a==null?void 0:a.user;t&&((i=t.user_metadata)==null?void 0:i.role)==="admin"&&await u(s)}e==="SIGNED_OUT"&&(sessionStorage.clear(),o||await u(l))})})();
