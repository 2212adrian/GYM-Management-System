(async function(){const o=await(async()=>{if(window.supabaseReady&&(await window.supabaseReady,window.supabaseClient))return window.supabaseClient;for(let a=0;a<20;a++){if(window.supabaseClient)return window.supabaseClient;await new Promise(t=>setTimeout(t,100))}return null})();if(!o)return;const m=new Set(["adrianangeles2212@gmail.com","ktorrazo123@gmail.com"]),g=new Set(["adrianangeles2213@gmail.com"]),d=a=>String(a||"").trim().toLowerCase(),h=a=>{var i;const t=d(a==null?void 0:a.email);if(!t)return null;if(m.has(t))return"admin";if(g.has(t))return"staff";const e=String(((i=a==null?void 0:a.app_metadata)==null?void 0:i.role)||"").trim().toLowerCase();return e==="admin"||e==="staff"?e:null},r=a=>{const t=d(a==null?void 0:a.email),e=h(a),i={email:t||null,role:e,isAdmin:e==="admin",isStaff:e==="staff",isAuthorized:e==="admin"||e==="staff"};return window.WOLF_USER_EMAIL=i.email,window.WOLF_USER_ROLE=i.role,window.WOLF_ACCESS_CONTEXT=i,i},u="/index.html",s="/pages/main.html",w="/pages/unauthorized.html",c=async a=>{try{if(window.wolfRouter){if(a===s){await window.wolfRouter.goToMain("dashboard",{replace:!0,seamless:!0});return}if(a===u){await window.wolfRouter.goToLogin({replace:!0,seamless:!0});return}}}catch(t){console.warn("Wolf OS Guard: Seamless redirect fallback ->",t)}window.location.replace(a)},n=window.location.pathname.toLowerCase(),l=n==="/"||n===""||n.endsWith("index.html")||n.endsWith("/index"),f=n.includes("/pages/main")||n.includes("/pages/dashboard")||n.includes("/pages/")&&!n.includes("unauthorized");async function S(){const{data:{session:a}}=await o.auth.getSession(),t=a==null?void 0:a.user,e=r(t);if(t&&!e.isAuthorized){await o.auth.signOut(),f&&window.location.replace(`${w}?err=102`);return}if(l&&e.isAuthorized){console.log("Wolf OS Guard: Active session found. Forwarding..."),await c(s);return}if(f&&!e.isAuthorized){window.location.replace(`${w}?err=102`);return}}await S(),o.auth.onAuthStateChange(async(a,t)=>{if(console.log("Guard Event:",a),a==="SIGNED_IN"&&l){r(t==null?void 0:t.user),console.log("Wolf OS Guard: Sign-in detected. Deferring to auth.js for animation.");return}if(a==="INITIAL_SESSION"&&l){const e=t==null?void 0:t.user,i=r(e);if(e&&!i.isAuthorized){await o.auth.signOut();return}i.isAuthorized&&await c(s)}a==="SIGNED_OUT"&&(r(null),sessionStorage.clear(),l||await c(u))})})();
