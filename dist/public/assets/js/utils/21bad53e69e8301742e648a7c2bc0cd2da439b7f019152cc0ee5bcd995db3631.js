(function(){const e=()=>{document.getElementById("wolf-system-alert")||document.body&&document.body.insertAdjacentHTML("beforeend",`<div id="wolf-system-alert" role="status" aria-live="assertive">
         <span class="alert-icon-wrap"><i class='bx alert-icon'></i></span>
         <span class="alert-copy">
           <span class="alert-code"></span>
           <span class="alert-text"></span>
         </span>
       </div>`)};document.body?e():document.addEventListener("DOMContentLoaded",e,{once:!0})})(),window.salesManager={allProducts:[],selectedProductId:null,placeholderImg:"/assets/images/placeholder.png",getAccessContext(){const t=window.WOLF_ACCESS_CONTEXT||{},e=String(t.role||window.WOLF_USER_ROLE||"").trim().toLowerCase(),s=String(t.email||window.WOLF_USER_EMAIL||"").trim().toLowerCase();return{role:e,email:s}},canHardDelete(){const{role:t,email:e}=this.getAccessContext();return t==="admin"||e==="adrianangeles2212@gmail.com"||e==="ktorrazo123@gmail.com"},_alertTimeout:null,hasErrPrefix(t){return/^\[ERR_[A-Z0-9_]+\]/i.test(String(t||"").trim())},enrichAlertMessage(t,e="success"){const s=String(t||"").trim();return s?this.hasErrPrefix(s)||e!=="error"&&e!=="warning"?s:/CHRONOLOCK_ACTIVE|FUTURE PROJECTION BLOCKED/i.test(s)?`[ERR_811] CHRONOLOCK_ACTIVE: ${s.replace(/^CHRONOLOCK_ACTIVE:\s*/i,"").trim()||s}`:/FUTURE_DATE_LOCKED|INVALID_PROTOCOL/i.test(s)?`[ERR_812] FUTURE_DATE_LOCKED: ${s.replace(/^INVALID_PROTOCOL:\s*/i,"").replace(/^FUTURE_DATE_LOCKED:\s*/i,"").trim()||s}`:/REQUEST EXCEEDS STOCK|STOCK LIMIT|EXCEEDS AVAILABLE/i.test(s)?`[ERR_802] STOCK_LIMIT: ${s}`:/OUT OF STOCK|NO STOCK AVAILABLE|INVENTORY DEPLETED/i.test(s)?`[ERR_801] STOCK_EMPTY: ${s}`:/SKU\\s*\\[[^\\]]+\\]\\s*(NOT FOUND|NOT RECOGNIZED|UNKNOWN)/i.test(s)?`[ERR_404] RESOURCE_MISSING: ${s}`:/DATABASE_REJECTED_ENTRY|TRANSACTION_FAILED|TRANSACTION_FAULT|PURGE_PROTOCOL_FAILED|ARCHIVE_RECORD_NOT_FOUND|ASSET VALIDATION FAILED|LOGBOOK_MODULE_NOT_READY/i.test(s)?`[ERR_500] SYSTEM_FAULT: ${s}`:`[ERR_500] SYSTEM_FAULT: ${s}`:""},splitAlertMessage(t){const e=String(t||"").trim(),s=e.match(/^\[(ERR_[A-Z0-9_]+)\]\s*(.*)$/i);return s?{code:s[1].toUpperCase(),detail:String(s[2]||"").trim()}:{code:"",detail:e}},showSystemAlert(t,e="success"){if(!window.matchMedia("(max-width: 767px)").matches)return;const o=document.getElementById("wolf-system-alert");if(!o)return;this._alertTimeout&&clearTimeout(this._alertTimeout);const a=e==="error"||e==="warning"||e==="success"?e:"success",i=this.enrichAlertMessage(t,a),r=this.splitAlertMessage(i),n={success:"bx-check-shield",error:"bx-error-alt",warning:"bx-shield-quarter"},d=o.querySelector(".alert-icon"),u=o.querySelector(".alert-code"),m=o.querySelector(".alert-text");if(d&&(d.className=`bx alert-icon ${n[a]||"bx-notification"}`),u&&(u.textContent=r.code?`[${r.code}]`:"",u.hidden=!r.code),m){const l=r.detail||i||"";m.textContent=l.toUpperCase()}o.classList.remove("show","success","error","warning"),o.classList.add(a),o.offsetWidth,requestAnimationFrame(()=>{o.classList.add("show")}),window.wolfAudio&&window.wolfAudio.play(a==="success"?"success":"error"),this._alertTimeout=setTimeout(()=>{o.classList.remove("show")},4e3)},showTopInstruction(t=!0){let e=document.getElementById("wolf-system-instruction");if(!t){e&&e.remove();return}e||(document.body.insertAdjacentHTML("beforeend",'<div id="wolf-system-instruction" class="system-instruction-banner"><div class="instruction-pulse"></div><span class="instruction-text">SCAN OR TYPE PRODUCT TO VALIDATE</span></div>'),e=document.getElementById("wolf-system-instruction")),e.classList.toggle("active",t)},async openSaleTerminal(t=null){this.allProducts.length===0&&await this.fetchProducts();let e;if(t&&(e=this.allProducts.find(i=>i.sku===t),!e)){this.showSystemAlert(`SKU [${t}] NOT FOUND`,"error");return}let s=document.getElementById("sale-terminal-overlay"),o=document.getElementById("sale-terminal-style");if(!s){const r=await(await fetch("/assets/components/record-sale-modal.html")).text(),n=document.createElement("div");n.innerHTML=r;const d=n.querySelector("style");d&&!o&&(d.id="sale-terminal-style",document.head.appendChild(d));const u=n.querySelector("#sale-terminal-overlay");if(!u)return;document.body.appendChild(u),s=u}const a=s.querySelector(".master-terminal-container");if(a&&(s.style.display="",s.style.visibility="",s.style.opacity="",s.classList.remove("is-closing"),a.classList.remove("modal-closing"),s.classList.add("is-open"),a.classList.add("modal-open"),this.showTopInstruction(!0),await this.fetchProducts(),this.attachSaleListeners(s),this.resetPreview(),e)){const i=s.querySelector("#sale-product-search");i&&(i.value=e.name),this.lockProduct(e);const r=s.querySelector("#sale-qty");r&&(r.value=1,r.classList.add("auto-filled")),this.validateTransaction()}},closeSaleTerminal(){const t=document.getElementById("sale-terminal-overlay");if(!t)return;this.showTopInstruction(!1);const e=t.querySelector(".master-terminal-container");t.classList.remove("is-open"),e.classList.remove("modal-open"),t.classList.add("is-closing"),e.classList.add("modal-closing"),setTimeout(()=>{t.remove();const s=document.getElementById("sale-terminal-style");s&&s.remove()},300)},async processQuickSale(t){if(!this.isProcessingQuick){this.isProcessingQuick=!0;try{const{data:e,error:s}=await supabaseClient.from("products").select("*").eq("sku",t).eq("is_active",!0).single();if(s||!e){this.showSystemAlert(`SKU [${t}] NOT RECOGNIZED`,"error");return}const o=Number(e.qty);if(o<1&&o<999999){this.showSystemAlert(`OUT OF STOCK: ${e.name}`,"error");return}const a=`AUTO-${Date.now().toString().slice(-4)}`,{error:i}=await supabaseClient.from("sales").insert([{sale_reference:a,product_id:e.productid,qty:1,unit_price:e.price,payment_status:"paid"}]);if(i)throw i;o<999999&&await supabaseClient.from("products").update({qty:o-1}).eq("productid",e.productid),this.showSystemAlert(`QUICK AUTH: ${e.name} x1`,"success"),window.wolfAudio&&window.wolfAudio.play("success"),window.wolfData&&typeof window.wolfData.loadSales=="function"&&window.wolfData.loadSales()}catch(e){console.error("Quick Sale Error:",e),this.showSystemAlert("TRANSACTION_FAILED","error"),window.wolfAudio&&window.wolfAudio.play("error")}finally{setTimeout(()=>{this.isProcessingQuick=!1},1500)}}},async fetchProducts(){const{data:t,error:e}=await supabaseClient.from("products").select("*").eq("is_active",!0);e||(this.allProducts=t)},attachSaleListeners(t){const e=t.querySelector("#record-sale-form"),s=t.querySelector("#sale-product-search"),o=t.querySelector("#custom-search-results"),a=t.querySelector("#sale-qty"),i=t.querySelector("#sale-qty-dec"),r=t.querySelector("#sale-qty-inc"),n=t.querySelector("#qrScanTrigger"),d=t.querySelector("#clearSearchBtn"),u=t.querySelector("#closeSaleModal");if(!s||!o)return;s.addEventListener("input",()=>{const l=s.value.trim().toLowerCase();if(l.length<1){o.classList.remove("active");return}const f=this.allProducts.filter(c=>c.name&&c.name.toLowerCase().includes(l)||c.sku&&c.sku.toLowerCase().includes(l));f.length>0?(o.innerHTML=f.map(c=>{const w=String(c.name||"UNKNOWN ASSET").toUpperCase();return`
            <div class="dropdown-item" data-id="${c.productid}">
                <span class="item-name">${w}</span>
                <span class="item-sku">SKU: ${c.sku}</span>
            </div>
        `}).join(""),o.classList.add("active")):o.classList.remove("active")}),o.onclick=l=>{const f=l.target.closest(".dropdown-item");if(f){const c=f.getAttribute("data-id"),w=this.allProducts.find(y=>y.productid===c);w&&(s.value=w.name,o.classList.remove("active"),this.lockProduct(w)),a&&(a.value=1,a.classList.add("auto-filled"),setTimeout(()=>{a.classList.remove("auto-filled")},500),this.validateTransaction())}},n&&(n.onclick=()=>{window.wolfScanner&&(t.style.display="none",window.wolfScanner.start(l=>{t.style.display="flex";const f=this.allProducts.find(c=>c.sku===l);f?(s.value=f.name,this.lockProduct(f)):this.showSystemAlert(`SKU [${l}] UNKNOWN`,"error"),this.openSaleTerminal(l)},!0,()=>{t.style.display="flex"}))}),d.onclick=()=>{this.unlockProductSelection(),window.wolfAudio&&window.wolfAudio.play("notif"),s.focus()},u.onclick=()=>{o.classList.remove("active"),this.closeSaleTerminal(),this.showTopInstruction(!1),this.selectedProductId=null};const m=()=>{const l=parseInt(a==null?void 0:a.value,10)||0,f=this.allProducts.find(y=>y.productid===this.selectedProductId),c=Number((f==null?void 0:f.qty)||0),w=c<999999;i&&(i.disabled=!f||l<=1),r&&(r.disabled=!f||(a==null?void 0:a.disabled)||w&&l>=c)};i&&(i.onclick=()=>{if(!a||a.disabled)return;const l=parseInt(a.value,10)||0;a.value=String(Math.max(1,l-1)),this.validateTransaction(),m()}),r&&(r.onclick=()=>{if(!a||a.disabled)return;const l=this.allProducts.find(y=>y.productid===this.selectedProductId);if(!l)return;const c=(parseInt(a.value,10)||0)+1,w=Number(l.qty||0);w<999999&&c>w||(a.value=String(Math.max(1,c)),this.validateTransaction(),m())}),a.oninput=()=>{(parseInt(a.value)||0)===1&&(a.classList.add("auto-filled"),setTimeout(()=>a.classList.remove("auto-filled"),500)),this.validateTransaction(),m()},e.onsubmit=async l=>{l.preventDefault(),this.processTransaction()},m(),document.addEventListener("click",l=>{l.target.closest("#searchWrapper")||o.classList.remove("active"),l.target.closest("#closeSaleModal")&&l.preventDefault()})},lockProduct(t){const e=document.getElementById("sale-product-search"),s=document.getElementById("searchWrapper"),o=document.getElementById("qrScanTrigger"),a=document.getElementById("clearSearchBtn"),i=document.getElementById("sale-qty"),r=document.getElementById("sale-qty-dec"),n=document.getElementById("sale-qty-inc");this.selectedProductId=t.productid,e.readOnly=!0,s.classList.add("is-locked"),o&&(o.style.display="none"),a&&(a.style.display="flex"),this.showTopInstruction(!1),this.updatePreview(t);const d=Number(t.qty||0);d>0?(i&&(i.value=1,i.classList.add("auto-filled"),setTimeout(()=>i.classList.remove("auto-filled"),500)),r&&(r.disabled=!0),n&&(n.disabled=d<=1)):(i&&(i.value=0),r&&(r.disabled=!0),n&&(n.disabled=!0),this.showSystemAlert(`OUT OF STOCK: ${t.name}`,"error")),this.validateTransaction(),window.wolfAudio&&window.wolfAudio.play("success")},unlockProductSelection(){const t=document.getElementById("sale-product-search"),e=document.getElementById("searchWrapper"),s=document.getElementById("qrScanTrigger"),o=document.getElementById("clearSearchBtn"),a=document.getElementById("sale-qty"),i=document.getElementById("sale-qty-dec"),r=document.getElementById("sale-qty-inc");this.selectedProductId=null,t&&(t.readOnly=!1,t.value=""),e&&e.classList.remove("is-locked"),s&&(s.style.display="flex"),o&&(o.style.display="none"),a&&(a.value="",a.disabled=!0,a.style.opacity="0.3"),i&&(i.disabled=!0),r&&(r.disabled=!0),this.resetPreview()},updatePreview(t){const e=document.getElementById("sale-qty"),s=document.getElementById("sale-qty-dec"),o=document.getElementById("sale-qty-inc"),a=document.getElementById("meta-price"),i=document.getElementById("meta-stock"),r=document.getElementById("asset-preview-img"),n=document.getElementById("asset-preview-desc");a&&(a.innerText=`₱${Number(t.price).toFixed(2)}`);const d=Number(t.qty||0);if(i&&(i.innerText=d>=999999?"∞":d,i.style.color=d<=0?"var(--wolf-red)":"#fff"),e)if(d<=0)e.disabled=!0,e.style.opacity="0.3",s&&(s.disabled=!0),o&&(o.disabled=!0),this.showSystemAlert(`OUT OF STOCK: ${t.name}`,"error");else{e.disabled=!1,e.style.opacity="1";const u=parseInt(e.value||"1",10)||1;if(s&&(s.disabled=u<=1),o){const m=d<999999;o.disabled=m&&u>=d}}r&&(r.src=t.image_url||this.placeholderImg),n&&(n.innerText=t.description||"NO TECHNICAL DATA FILED.")},validateTransaction(){const t=document.getElementById("sale-qty"),e=document.getElementById("sale-submit-btn"),s=document.getElementById("sale-total-display"),o=parseInt(t.value)||0,a=this.allProducts.find(r=>r.productid===this.selectedProductId);if(!a){e&&(e.disabled=!0);return}const i=Number(a.qty||0);i<999999&&o>i?(t.classList.add("input-error"),window.wolfAudio&&window.wolfAudio.play("denied"),i<=0?this.showSystemAlert(`OUT OF STOCK: ${a.name}`,"error"):this.showSystemAlert(`REQUEST EXCEEDS STOCK: ${a.name} (MAX ${i})`,"error"),t.value="",s&&(s.innerText="₱0.00"),e.disabled=!0,setTimeout(()=>t.classList.remove("input-error"),500)):o<=0?e.disabled=!0:(t.classList.remove("input-error"),e.disabled=!1),this.calculateTotal()},resetPreview(){const t=document.getElementById("asset-preview-img"),e=document.getElementById("asset-preview-desc"),s=document.getElementById("meta-price"),o=document.getElementById("meta-stock"),a=document.getElementById("sale-submit-btn"),i=document.getElementById("sale-qty"),r=document.getElementById("sale-qty-dec"),n=document.getElementById("sale-qty-inc");i&&(i.value="",i.disabled=!0,i.style.opacity="0.3"),r&&(r.disabled=!0),n&&(n.disabled=!0),t&&(t.src=this.placeholderImg),e&&(e.innerText="SELECT AN ASSET TO LOAD TECHNICAL DATA PROTOCOL..."),s&&(s.innerText="₱0.00"),o&&(o.innerText="--"),a&&(a.disabled=!0),this.calculateTotal()},calculateTotal(){const t=document.getElementById("sale-qty"),e=document.getElementById("sale-total-display");if(!this.selectedProductId){e&&(e.innerText="₱0.00");return}const s=this.allProducts.find(a=>a.productid===this.selectedProductId),o=parseInt(t.value)||0;if(s&&e){const a=Number(s.price)*o;e.innerText=`₱${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}else e&&(e.innerText="₱0.00")},async processTransaction(){const t=document.getElementById("sale-submit-btn"),e=document.getElementById("record-sale-form"),s=document.getElementById("sale-qty"),o=parseInt(s.value);t.disabled=!0,t.textContent="SYNCHRONIZING...";try{const{data:a,error:i}=await supabaseClient.from("products").select("*").eq("productid",this.selectedProductId).single();if(i||!a)throw new Error("Asset validation failed.");const r=Number(a.qty);if(r<999999&&r<o)throw new Error("INSUFFICIENT_STOCK");const n=`SALE-${Date.now().toString().slice(-4)}`,{error:d}=await supabaseClient.from("sales").insert([{sale_reference:n,product_id:this.selectedProductId,qty:o,unit_price:a.price,payment_status:"paid"}]);if(d)throw d;r<999999&&await supabaseClient.from("products").update({qty:r-o}).eq("productid",this.selectedProductId),this.showSystemAlert(`PRODUCT ADDED: ${a.name.toUpperCase()} x${o}`),Toastify({text:`PRODUCT ADDED: ${a.name.toUpperCase()} x${o}`,duration:2500,gravity:"top",position:"right",style:{border:"1px solid #77ff00",background:"#0a0a0a",borderRadius:"12px",fontWeight:"900",fontFamily:"JetBrains Mono, monospace",color:"#fff"}}).showToast(),window.wolfData&&window.wolfData.loadSales();const u=document.getElementById("sale-terminal-overlay");this.unlockProductSelection(),u&&(u.style.display="none"),e&&e.reset(),window.wolfData&&typeof window.wolfData.loadSales=="function"&&window.wolfData.loadSales(),window.wolfAudio&&window.wolfAudio.play("success")}catch(a){this.showSystemAlert(a.message,"error"),window.wolfAudio&&window.wolfAudio.play("error")}finally{t.disabled=!1,t.textContent="AUTHORIZE TRANSACTION"}},async processQuickSale(t){if(!this.isProcessingQuick){this.isProcessingQuick=!0;try{const{data:e,error:s}=await supabaseClient.from("products").select("*").eq("sku",t).eq("is_active",!0).single();if(s||!e){this.showSystemAlert(`SKU [${t}] NOT FOUND`,"error");return}const o=Number(e.qty);if(o<1&&o<999999){this.showSystemAlert(`OUT OF STOCK: ${e.name}`,"error");return}const a=`AUTO-${Date.now().toString().slice(-4)}`,{error:i}=await supabaseClient.from("sales").insert([{sale_reference:a,product_id:e.productid,qty:1,unit_price:e.price,payment_status:"paid"}]);if(i)throw i;o<999999&&await supabaseClient.from("products").update({qty:o-1}).eq("productid",e.productid),this.showSystemAlert(`PRODUCT ADDED: ${e.name} x1`,"success"),Toastify({text:`PRODUCT ADDED: ${e.name.toUpperCase()} x1`,duration:2500,gravity:"top",position:"right",style:{border:"1px solid #77ff00",background:"#0a0a0a",borderRadius:"12px",fontWeight:"900",fontFamily:"JetBrains Mono, monospace",color:"#fff"}}).showToast(),window.wolfAudio&&window.wolfAudio.play("success"),window.wolfData&&window.wolfData.loadSales&&window.wolfData.loadSales()}catch(e){console.error(e),this.showSystemAlert("TRANSACTION_FAULT","error")}finally{setTimeout(()=>{this.isProcessingQuick=!1},1e3)}}},async initModal(){if(document.getElementById("product-modal-overlay"))return!0;try{const e=await(await fetch("/assets/components/add-product-modal.html")).text();return document.body.insertAdjacentHTML("beforeend",e),this.attachEventListeners(),!0}catch(t){return!1}},async openAddTerminal(){if(!await this.initModal())return;const e=document.getElementById("product-modal-overlay"),s=document.getElementById("master-product-form"),o=document.getElementById("master-qty");s&&s.reset(),o&&(o.disabled=!1,o.placeholder="0",o.style.opacity="1"),this.generateRandomID(),e.style.display="flex",window.wolfAudio&&window.wolfAudio.play("notif")},generateRandomID(){const t=document.getElementById("master-asset-id");t&&(t.value=Math.floor(1e3+Math.random()*9e3))},attachEventListeners(){const t=document.getElementById("product-modal-overlay"),e=document.getElementById("master-product-form"),s=document.getElementById("closeProductModal"),o=document.getElementById("master-asset-id"),a=document.getElementById("generateRandomId"),i=document.getElementById("master-unlimited"),r=document.getElementById("master-qty");a&&(a.onclick=()=>{this.generateRandomID(),window.wolfAudio.play("notif")}),o&&(o.oninput=n=>{n.target.value=n.target.value.replace(/[^0-9]/g,"")}),i&&(i.onchange=n=>{r.disabled=n.target.checked,r.value="",r.placeholder=n.target.checked?"∞":"0",r.style.opacity=n.target.checked?"0.3":"1"}),e&&(e.onsubmit=async n=>{n.preventDefault();const d=e.querySelector(".btn-commit");d.disabled=!0,d.textContent="COMMITTING...";const u={sku:"PR-"+o.value,name:document.getElementById("master-name").value.toUpperCase(),description:document.getElementById("master-desc").value,price:parseFloat(document.getElementById("master-price").value),qty:i.checked?999999:parseInt(r.value||0),is_active:!0};try{const{error:m}=await supabaseClient.from("products").insert([u]);if(m)throw m;window.wolfAudio&&window.wolfAudio.play("success"),t.style.display="none",e.reset()}catch(m){window.wolfAudio&&window.wolfAudio.play("error"),alert("PROTOCOL_FAULT: Database rejected entry.")}finally{d.disabled=!1,d.textContent="COMMIT RECORD CHANGES"}})},async openTrashBin(){const t=this.currentTrashMode||"sales",e="/assets/components/trash-modal.html";if(!document.getElementById("sales-trash-overlay")){const i=await(await fetch(e)).text();document.body.insertAdjacentHTML("beforeend",i)}await new Promise(a=>setTimeout(a,50));const s=document.getElementById("sales-trash-overlay");if(!s)return;const o=s.querySelector(".terminal-title");if(o){const a=t==="sales"?"SALES":"LOGBOOK";o.innerHTML=`${a} <span>TRASH BIN</span>`}document.getElementById("closeTrashModal").onclick=()=>this.closeTrash(),document.getElementById("closeTrashBtn").onclick=()=>this.closeTrash(),s.style.display="flex",window.wolfAudio&&window.wolfAudio.play("notif"),this.loadTrashItems(t)},closeTrash(){const t=document.getElementById("sales-trash-overlay");t&&(t.classList.add("closing"),setTimeout(()=>{t.style.display="none",t.classList.remove("closing")},300))},async loadTrashItems(t){const e=document.getElementById("trash-list-container");if(!e)return;t==="sales"&&this.allProducts.length===0&&await this.fetchProducts();const s=t==="sales"?"sales":"check_in_logs",a=(window.wolfData&&window.wolfData.serverToday?window.wolfData.serverToday:new Date).toLocaleDateString("en-CA"),i=`${a}T00:00:00+08:00`,r=`${a}T23:59:59+08:00`,{data:n,error:d}=await supabaseClient.from("trash_bin").select("*").eq("table_name",s).gte("deleted_at",i).lte("deleted_at",r).order("deleted_at",{ascending:!1});if(d||!n||n.length===0){e.innerHTML=`
        <div style="text-align:center; padding:60px; opacity:0.3;">
          <i class='bx bx-folder-open' style='font-size:4rem;'></i>
          <p style='font-size:12px; font-weight:900; margin-top:15px; text-transform: uppercase;'>
            ARCHIVE_EMPTY_FOR_TODAY
          </p>
        </div>`;return}const u=this.canHardDelete();e.innerHTML=n.map(m=>{var w;const l=m.deleted_data;let f="",c="";if(t==="sales"){const y=this.allProducts.find(E=>E.productid===l.product_id);f=y?y.name:"DELETED_PRODUCT";const p=Number(l.total_amount||0).toLocaleString(void 0,{minimumFractionDigits:2}),h=y?y.sku:l.product_id?l.product_id.slice(0,8):"N/A";c=`₱${p} | SKU: ${h}`}else{f=((w=l.notes)==null?void 0:w.replace("WALK-IN: ",""))||"MEMBER_ENTRY";const y=new Date(l.time_in).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),p=l.time_out?new Date(l.time_out).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"STILL_ACTIVE";c=`IN: ${y} | OUT: ${p}`}return`
        <div class="trash-item-card">
            <div class="trash-item-info">
                <span class="trash-prod-name">${f.toUpperCase()}</span>
                <div class="trash-tech-row" style="text-transform: uppercase;">
                    ${c.toUpperCase()}
                </div>
            </div>
            <div class="trash-actions">
                <button class="btn-restore" title="RESTORE" onclick="salesManager.restoreSale('${m.id}', '${t}')">
                    <i class='bx bx-undo'></i>
                </button>
                ${u?`<button class="btn-purge" title="DELETE_PERMANENT" onclick="salesManager.purgeSale('${m.id}', '${t}')">
                    <i class='bx bx-trash'></i>
                </button>`:""}
            </div>
        </div>`}).join("")},async purgeSale(t,e){if(!this.canHardDelete()){this.showSystemAlert("ACCESS_DENIED: ONLY ADMIN CAN HARD DELETE","error");return}if(!(!window.Swal||!(await window.Swal.fire({title:"DELETE PERMANENTLY?",html:`
        <div style="color: #b47023; font-size: 4.5rem; margin-bottom: 10px;">
          <i class='bx bx-trash-alt'></i>
        </div>
        <p class="wolf-swal-text" style="text-transform: uppercase;">
          CRITICAL: THIS ACTION CANNOT BE UNDONE. RECORD WILL BE REMOVED FOREVER. PROCEED?
        </p>
      `,showCancelButton:!0,confirmButtonText:"DELETE",cancelButtonText:"ABORT",reverseButtons:!0,background:"#111",buttonsStyling:!1,customClass:{popup:"wolf-swal-popup-orange",confirmButton:"wolf-swal-confirm-orange",cancelButton:"wolf-swal-cancel"}})).isConfirmed))try{const{error:o}=await supabaseClient.from("trash_bin").delete().eq("id",t);if(o)throw o;this.showSystemAlert("RECORD_PERMANENTLY_PURGED","success"),window.wolfAudio&&window.wolfAudio.play("success"),this.loadTrashItems(e)}catch(o){console.error("Purge Fault:",o),window.wolfAudio&&window.wolfAudio.play("error"),this.showSystemAlert("PURGE_PROTOCOL_FAILED","error")}},async restoreSale(t,e){if(window.Swal)try{const s=e==="sales",o=s?"PROCEED WITH RESTORATION: THIS WILL RE-DEDUCT QUANTITY FROM STOCK.":"PROCEED WITH RESTORATION: THIS RECORD WILL RETURN TO THE LOGBOOK.";if(!(await Swal.fire({title:"RESTORE PRODUCT?",html:`<p class="wolf-swal-text" style="text-transform: uppercase;">${o}</p>`,showCancelButton:!0,confirmButtonText:"RESTORE",background:"#111",buttonsStyling:!1,customClass:{popup:"wolf-swal-popup-green",cancelButton:"wolf-swal-cancel",confirmButton:"wolf-swal-confirm-green"}})).isConfirmed)return;const{data:i,error:r}=await supabaseClient.from("trash_bin").select("*").eq("id",t).single();if(r||!i)throw new Error("ARCHIVE_RECORD_NOT_FOUND");const n={...i.deleted_data},d=s?"sales":"check_in_logs";let u=null;if(s){const{data:c}=await supabaseClient.from("products").select("qty, name, sku").eq("productid",n.product_id).single();if(c){if(c.qty<n.qty&&c.qty<999999)throw new Error("INSUFFICIENT_STOCK");c.qty<999999&&await supabaseClient.from("products").update({qty:c.qty-n.qty}).eq("productid",n.product_id),u={name:c.name,sku:c.sku}}}const m={...n};delete m.id,delete m.total_amount,delete m.created_at,delete m.products;const{data:l,error:f}=await supabaseClient.from(d).insert([m]).select().single();if(f)throw f;if(await supabaseClient.from("trash_bin").delete().eq("id",t),this.closeTrash(),window.wolfData){if(s){const c={...l,products:u};window.wolfData.allSales=[c,...window.wolfData.allSales];const w=window.wolfData.allSales.reduce((y,p)=>y+Number(p.total_amount||0),0);window.wolfData.refreshSummaryHUD(w),window.wolfData.renderSales(window.wolfData.selectedDate.getDay())}else await window.wolfData.loadLogbook();typeof window.wolfData.scheduleGoalActualsSync=="function"&&window.wolfData.scheduleGoalActualsSync(40)}if(s&&u){const c=n.qty||1;this.showSystemAlert(`${u.name}, X${c} WAS RESTORED`,"success"),Toastify({text:`${u.name}, ${n.qty} WAS RESTORED`,duration:4e3,gravity:"top",position:"right",stopOnFocus:!0,style:{border:"1px solid #77ff00",background:"#0a0a0a",borderRadius:"12px",fontWeight:"900",fontFamily:"JetBrains Mono, monospace",color:"#fff"}}).showToast()}window.wolfAudio&&window.wolfAudio.play("success")}catch(s){console.error("Restore Error:",s),window.wolfAudio&&window.wolfAudio.play("error"),this.showSystemAlert(s.message.toUpperCase(),"error")}}},document.addEventListener("click",t=>{t.target.closest("#clear-sales-btn")&&window.salesManager.openTrashBin()});
