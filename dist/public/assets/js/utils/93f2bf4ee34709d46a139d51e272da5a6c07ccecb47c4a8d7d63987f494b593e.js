window.wolfRetry=async function(){const e=document.querySelector(".retry-btn"),o=e==null?void 0:e.querySelector("i"),t=e==null?void 0:e.querySelector("span");e&&(e.disabled=!0,o&&(o.className="bx bx-loader-alt bx-spin"),t&&(t.innerText="RE-ESTABLISHING LINK..."));try{const n=await fetch("/favicon.ico",{mode:"no-cors",cache:"no-store"}),a=window.WOLF_LAST_REQUESTED_PAGE||window.WOLF_CURRENT_PAGE||new URLSearchParams(window.location.search).get("p")||"dashboard";if(typeof navigateTo=="function"){await navigateTo(a,{updateRoute:!1});return}if(window.wolfRouter&&typeof window.wolfRouter.refreshCurrent=="function"){await window.wolfRouter.refreshCurrent({replace:!0});return}window.location.reload()}catch(n){console.warn("Wolf OS: Link attempt failed. Signal still dead."),setTimeout(()=>{e&&(e.disabled=!1,o&&(o.className="bx bx-refresh"),t&&(t.innerText="RETRY CONNECTION"))},1500)}};const WOLF_PURIFIER=e=>DOMPurify.sanitize(e,{ALLOWED_TAGS:["div","span","p","a","button","input","label","ul","li","table","thead","tbody","tr","td","section","header","footer","main","nav","i","h1","h2","h3","h4","h5","h6","style","form","textarea","select","option","img"],ALLOWED_ATTR:["class","id","style","data-page","data-date","data-day","data-id","data-product-id","href","type","value","placeholder","aria-label","role","src","alt","accept","hidden"],KEEP_CONTENT:!0,FORBID_TAGS:["script","iframe","object","embed"],FORBID_ATTR:["onerror","onload","onclick"]}),getSkeletonUI=()=>`
  <div class="skeleton-wrapper">
    <div class="skeleton skeleton-title"></div>
    <div class="skeleton skeleton-text"></div>
    <div class="skeleton skeleton-text" style="width: 80%"></div>
    <div class="skeleton skeleton-box" style="margin-top: 20px;"></div>
    <div class="skeleton skeleton-box"></div>
  </div>
`,themeManager={init(){localStorage.getItem("wolf-theme")==="light"&&document.body.classList.add("light-theme")},toggle(){const e=document.body.classList.toggle("light-theme");localStorage.setItem("wolf-theme",e?"light":"dark"),document.querySelectorAll("#themeToggleBtn i, .theme-icon").forEach(t=>{e?t.classList.replace("bx-moon","bx-sun"):t.classList.replace("bx-sun","bx-moon")})}};themeManager.init();let wolfMainRouter=null,wolfMainRouterSyncing=!1,wolfLogoutInProgress=!1,wolfNavInFlight=!1,wolfNavCooldownUntil=0;const WOLF_MAIN_PAGE_ALIASES=Object.freeze({audit:"audit-log"});function normalizeMainPage(e){const o=String(e||"").trim().toLowerCase();return o?WOLF_MAIN_PAGE_ALIASES[o]||o:"dashboard"}function getWolfAccessContext(){const e=window.WOLF_ACCESS_CONTEXT||{},o=String(e.role||window.WOLF_USER_ROLE||"").trim().toLowerCase(),t=String(e.email||window.WOLF_USER_EMAIL||"").trim().toLowerCase();return{role:o,email:t,isAdmin:o==="admin"||t==="adrianangeles2212@gmail.com"||t==="ktorrazo123@gmail.com",isStaff:o==="staff"||t==="adrianangeles2213@gmail.com"}}function canAccessMainPage(e){const o=normalizeMainPage(e),t=getWolfAccessContext();return!(new Set(["audit-log","goal-center"]).has(o)&&!t.isAdmin)}function applyRoleBasedVisibility(e=document){const o=getWolfAccessContext();["audit-log","goal-center"].forEach(n=>{e.querySelectorAll(`[data-page="${n}"]`).forEach(a=>{a.style.display=o.isAdmin?"":"none"})})}async function hydrateSidebarAuthIdentity(){var i,r,p,m;const e=document.querySelector("#wolfSidebar .user-name"),o=document.querySelector("#wolfSidebar .user-email");if(!e&&!o)return;const t=window.WOLF_ACCESS_CONTEXT||{};let n=String(t.email||window.WOLF_USER_EMAIL||"").trim().toLowerCase(),a=String(t.displayName||t.full_name||t.name||"").trim();try{if((!n||!a)&&(window.supabaseReady&&typeof window.supabaseReady.then=="function"&&await window.supabaseReady,(r=(i=window.supabaseClient)==null?void 0:i.auth)!=null&&r.getUser)){const{data:c}=await window.supabaseClient.auth.getUser(),d=(c==null?void 0:c.user)||null;d!=null&&d.email&&(n=String(d.email).trim().toLowerCase()),a||(a=String(((p=d==null?void 0:d.user_metadata)==null?void 0:p.display_name)||((m=d==null?void 0:d.user_metadata)==null?void 0:m.full_name)||"").trim())}}catch(c){}a||(a=n?n.split("@")[0]:"Wolf User"),e&&(e.textContent=String(a).toUpperCase()),o&&n&&(o.textContent=n)}function getUnauthorizedUI(e){return`
    <div class="wolf-page-intro" style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:62vh; text-align:center; color:var(--text-main); padding: 24px;">
      <i class='bx bx-shield-quarter' style="font-size:74px; color:var(--wolf-red); margin-bottom:16px;"></i>
      <h1 style="font-size:30px; font-weight:900; letter-spacing:0.5px; margin:0;">ACCESS DENIED</h1>
      <p style="margin:10px 0 0 0; color:var(--text-muted); font-size:13px; letter-spacing:0.8px; text-transform:uppercase;">
        You do not have permission to enter ${String(e||"module").toUpperCase()}.
      </p>
      <p style="margin:8px 0 22px 0; color:var(--text-muted); font-size:12px;">
        User is unauthorized for this module.
      </p>
      <button
        type="button"
        onclick="navigateTo('hub')"
        style="background:var(--wolf-red); color:var(--text-on-accent); border:none; padding:10px 18px; border-radius:10px; font-weight:800; letter-spacing:0.8px; text-transform:uppercase; cursor:pointer;"
      >
        Return to Hub
      </button>
    </div>
  `}function getInitialMainPage(){const e=String(window.location.hash||""),o=e.startsWith("#/")?e.slice(2).trim():"",t=new URLSearchParams(window.location.search).get("p");return normalizeMainPage(o||t||"dashboard")}function initMainRouter(){typeof Navigo=="undefined"||wolfMainRouter||(wolfMainRouter=new Navigo("/",{hash:!0}),wolfMainRouter.on("/:page",e=>{var t;if(wolfMainRouterSyncing)return;const o=normalizeMainPage(String(((t=e==null?void 0:e.data)==null?void 0:t.page)||"").trim()||"dashboard");navigateTo(o,{updateRoute:!1})}),wolfMainRouter.notFound(()=>{wolfMainRouterSyncing||navigateTo("dashboard",{updateRoute:!1})}))}async function playLogoutOutro(){if(wolfLogoutInProgress)return;wolfLogoutInProgress=!0,document.body.classList.remove("logout-outro-final"),document.body.classList.add("logout-outro-active");const e=document.getElementById("logout-overlay");e&&e.setAttribute("aria-hidden","false"),window.wolfAudio&&(window.wolfAudio.play("woosh"),setTimeout(()=>{window.wolfAudio.play("logoff")},180)),await new Promise(o=>setTimeout(o,1550)),document.body.classList.add("logout-outro-final"),await new Promise(o=>setTimeout(o,950))}function rollbackLogoutOutro(){document.body.classList.remove("logout-outro-final"),document.body.classList.remove("logout-outro-active");const e=document.getElementById("logout-overlay");e&&e.setAttribute("aria-hidden","true"),wolfLogoutInProgress=!1}window.handleLogout=async function(){const e=window.Swal,o=window.supabaseClient,t=async()=>{var n;if(!wolfLogoutInProgress)try{await playLogoutOutro(),(n=o==null?void 0:o.auth)!=null&&n.signOut?await o.auth.signOut():sessionStorage.clear(),window.wolfRouter&&typeof window.wolfRouter.goToLogin=="function"?await window.wolfRouter.goToLogin({replace:!0,seamless:!0}):window.location.replace("/index.html")}catch(a){rollbackLogoutOutro(),e?e.fire({title:"LOGOUT FAILED",html:`<div style="color:var(--wolf-red); font-size:3rem; margin-bottom:12px;"><i class='bx bx-error-alt'></i></div>
                 <p style="color:#888; font-size:13px;">${a.message||"Unknown error"}</p>`,background:"#111",buttonsStyling:!1,customClass:{popup:"wolf-swal-popup wolf-border-red",title:"wolf-swal-title",confirmButton:"btn-wolf-red"},confirmButtonText:"OK"}):alert(`Logout failed: ${a.message||"Unknown error"}`)}};e?(await e.fire({title:"TERMINATE SESSION?",html:`<div style="color:#ff4d4d; font-size:3rem; margin-bottom:12px;"><i class='bx bx-power-off'></i></div>
             <p style="color:#888; font-size:13px;">You will be logged out of Wolf OS.</p>`,showCancelButton:!0,confirmButtonText:"LOGOUT",cancelButtonText:"CANCEL",reverseButtons:!0,background:"#111",buttonsStyling:!1,customClass:{popup:"wolf-swal-popup wolf-border-red",title:"wolf-swal-title",confirmButton:"btn-wolf-red",cancelButton:"btn-wolf-secondary"}})).isConfirmed&&await t():confirm("Log out of Wolf OS?")&&await t()};async function loadComponent(e,o){const t=document.getElementById(e);if(t)try{const n=await fetch(o);if(!n.ok)throw new Error("Failed to load component");const a=await n.text();t.insertAdjacentHTML("beforeend",a),t.querySelectorAll("style").forEach(r=>{document.head.appendChild(r)})}catch(n){console.error("loadComponent error:",n)}}function updateNavHighlights(e){document.querySelectorAll("[data-page]").forEach(t=>{const n=t.getAttribute("data-page")===e,a=t.querySelector("i");n?(t.classList.add("active"),a&&(a.classList.contains("bx-target")?a.className="bxf bx-target":a.className=a.className.replace(/\bbx-([a-z0-9-]+)\b/g,"bxs-$1"))):(t.classList.remove("active"),a&&(a.classList.contains("bx-target")||a.classList.contains("bxf")?a.className="bx bx-target":a.className=a.className.replace(/\bbxs-([a-z0-9-]+)\b/g,"bx-$1")))}),syncDropdownActiveLabels()}function syncDropdownActiveLabels(){document.querySelectorAll(".nav-dropdown").forEach(e=>{e.querySelector(".sub-item.active")?e.classList.add("active-only"):e.classList.remove("active-only")})}document.querySelectorAll("[data-page]").forEach(e=>{e.onclick=o=>{o.preventDefault();const t=e.getAttribute("data-page");t&&navigateTo(t)}});const themeBtn=document.getElementById("themeToggleBtn");themeBtn&&(themeBtn.onclick=e=>{e.preventDefault(),e.stopPropagation();const o=themeBtn.querySelector("i");o&&(o.classList.toggle("bx-moon"),o.classList.toggle("bx-sun"))});function wolfRefreshView(){var n;const e=((n=document.getElementById("ledger-title"))==null?void 0:n.innerText)||"",o=document.getElementById("ledger-main-search"),t=o?o.value.trim():"";e.includes("LOGBOOK")?window.wolfData&&typeof window.wolfData.loadLogbook=="function"&&window.wolfData.loadLogbook():window.wolfData&&typeof window.wolfData.loadSales=="function"&&window.wolfData.loadSales(),e.includes("LOGBOOK")?window.wolfData&&typeof window.wolfData.loadLogs=="function"&&window.wolfData.loadLogs():window.wolfData&&typeof window.wolfData.loadSales=="function"&&window.wolfData.loadSales()}async function closeAllActiveModals(){const e=t=>{if(!t)return;t.style.display="none",t.style.opacity="0",t.classList.remove("is-open","is-closing","closing");const n=t.querySelector(".master-terminal-container");n&&n.classList.remove("modal-open","modal-closing")},o=t=>{const n=document.getElementById(t);e(n)};try{typeof closeProductModal=="function"&&window.isProductModalOpen&&closeProductModal()}catch(t){console.warn("Wolf OS: Product modal close handler failed.",t)}o("product-modal-overlay"),window.isProductModalOpen=!1;try{window.salesManager&&typeof window.salesManager.closeSaleTerminal=="function"&&window.salesManager.closeSaleTerminal()}catch(t){console.warn("Wolf OS: Sales terminal close handler failed.",t)}o("sale-terminal-overlay");try{window.logbookManager&&typeof window.logbookManager.closeLogbookTerminal=="function"&&window.logbookManager.closeLogbookTerminal()}catch(t){console.warn("Wolf OS: Logbook terminal close handler failed.",t)}o("logbook-modal-overlay");try{window.salesManager&&typeof window.salesManager.closeTrash=="function"&&window.salesManager.closeTrash()}catch(t){console.warn("Wolf OS: Trash modal close handler failed.",t)}o("sales-trash-overlay");try{window.wolfScanner&&typeof window.wolfScanner.stop=="function"&&document.getElementById("wolf-scanner-overlay")&&await window.wolfScanner.stop({skipOnClose:!0})}catch(t){console.warn("Wolf OS: Scanner close handler failed.",t)}o("wolf-scanner-overlay"),o("scanResultModal"),document.querySelectorAll(".master-modal-overlay, .wolf-modal-overlay, .modal-overlay").forEach(t=>e(t))}async function navigateTo(e,o={}){var d;const t=Date.now();if(wolfNavInFlight||t<wolfNavCooldownUntil)return;wolfNavInFlight=!0,document.body.classList.add("wolf-nav-lock");const n=document.getElementById("main-content"),a=document.getElementById("topbar-brand");if(!n){wolfNavInFlight=!1,wolfNavCooldownUntil=Date.now()+220,document.body.classList.remove("wolf-nav-lock");return}const{updateRoute:i=!0}=o;if(e=normalizeMainPage(e),!canAccessMainPage(e)){const l=getUnauthorizedUI(e);n.innerHTML=l,n.style.opacity="1",updateNavHighlights(""),window.WOLF_CURRENT_PAGE="unauthorized",window.WOLF_LAST_REQUESTED_PAGE=e,a&&(a.innerHTML=`
        <div class="breadcrumb-container" style="display: flex; align-items: center; gap: 8px;">
          <span style="opacity:0.5;">SYSTEM</span>
          <i class='bx bx-chevron-right' style="color: var(--wolf-red); font-size:1.2rem; font-weight:bold;"></i>
          <span style="letter-spacing: 1px; font-weight: 800; color: var(--wolf-red);">UNAUTHORIZED</span>
        </div>
      `),wolfNavInFlight=!1,wolfNavCooldownUntil=Date.now()+280,document.body.classList.remove("wolf-nav-lock");return}window.WOLF_LAST_REQUESTED_PAGE=e,await closeAllActiveModals();const r={dashboard:{label:"DASHBOARD",parent:"MAIN",parentRoute:"hub",section:"main"},home:{label:"WOLF <span>PALOMAR</span> GYM",parent:null},hub:{label:"COMMAND CENTER",parent:"WOLF OS",section:"main"},members:{label:"MEMBERS",parent:"MANAGEMENT",parentRoute:"hub",section:"admin"},products:{label:"PRODUCTS",parent:"MANAGEMENT",parentRoute:"hub",section:"admin"},"management/products":{label:"PRODUCTS",parent:"MANAGEMENT",parentRoute:"hub",section:"admin"},equipments:{label:"EQUIPMENTS",parent:"MANAGEMENT",parentRoute:"hub",section:"admin"},sales:{label:"SALES",parent:"LEDGER",parentRoute:"hub",section:"main"},logbook:{label:"LOGBOOK",parent:"LEDGER",parentRoute:"hub",section:"main"},settings:{label:"SETTINGS",parent:"SYSTEM",parentRoute:"hub",section:"system"},"id-maker":{label:"ID MAKER",parent:"SYSTEM TOOLS",parentRoute:"hub",section:"system"},"goal-center":{label:"GOAL CENTER",parent:"SYSTEM TOOLS",parentRoute:"hub",section:"system"},feedback:{label:"FEEDBACK",parent:"SYSTEM TOOLS",parentRoute:"hub",section:"system"},"audit-log":{label:"AUDIT LOG",parent:"SYSTEM",parentRoute:"hub",section:"system"}},p=`
    <div class="wolf-skeleton">
      <style>
        .wolf-skeleton { padding: 40px; max-width: 1200px; margin: 0 auto; opacity: 0; animation: fadeInSkel 0.3s forwards; }
        .skel-shimmer {
          background: linear-gradient(90deg, var(--skeleton-base, #242a32) 25%, var(--skeleton-mid, #313844) 50%, var(--skeleton-base, #242a32) 75%);
          background-size: 200% 100%;
          animation: skel-loading 1.5s infinite linear;
          border-radius: 8px;
          border: 1px solid var(--border-color, rgba(255, 255, 255, 0.08));
        }
        @keyframes skel-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        @keyframes fadeInSkel { from { opacity: 0; } to { opacity: 1; } }
        .skel-title { width: 150px; height: 35px; margin-bottom: 40px; }
        .skel-income-card { width: 100%; height: 180px; border-radius: 20px; margin-bottom: 30px; }
        .skel-nav-bar { width: 100%; height: 50px; margin-bottom: 20px; display: flex; gap: 10px; }
        .skel-entry { width: 100%; height: 80px; margin-bottom: 15px; border-radius: 15px; }
      </style>
      <div class="skel-shimmer skel-title"></div>
      <div class="skel-shimmer skel-income-card"></div>
      <div class="skel-nav-bar"><div class="skel-shimmer" style="flex:1"></div><div class="skel-shimmer" style="flex:3"></div><div class="skel-shimmer" style="flex:1"></div></div>
      <div class="skel-shimmer skel-entry"></div><div class="skel-shimmer skel-entry"></div><div class="skel-shimmer skel-entry"></div><div class="skel-shimmer skel-entry"></div>
    </div>
  `,m=`
    <div class="wolf-page-intro" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:70vh; text-align:center; color:var(--text-main);">
      <i class='bx bx-wifi-off' style="font-size:80px; color:var(--wolf-red); margin-bottom:20px;"></i>
      <h1 style="font-size:32px; font-weight:900; margin:0; letter-spacing:-1px;">SIGNAL LOST</h1>
      <p style="color:var(--text-muted); max-width:400px; margin:15px 0 30px 0; line-height:1.6;">The encrypted uplink to Wolf OS was severed.</p>
      <button class="retry-btn" onclick="window.wolfRetry()" style="background:var(--wolf-red); color:var(--text-on-accent); border:none; padding:12px 30px; font-weight:bold; border-radius:8px; cursor:pointer; text-transform:uppercase; display:flex; align-items:center; gap:10px;">
        <i class='bx bx-refresh' style="font-size:20px;"></i>
        <span>RETRY CONNECTION</span>
      </button>
    </div>
  `;if(!navigator.onLine){n.innerHTML=m,n.style.opacity="1",wolfNavInFlight=!1,wolfNavCooldownUntil=Date.now()+220,document.body.classList.remove("wolf-nav-lock");return}n.innerHTML=p,n.style.opacity="1";const c=new Promise(l=>setTimeout(l,600));try{let l,y=!1;e==="sales"||e==="logbook"?(l="/assets/views/daily-ledger.html",y=!0):e==="members"?l="/pages/management/members.html":e==="management/products"||e==="products"?l="/pages/management/products.html":e==="audit-log"?l="/pages/audit.html":l=`/pages/${e}.html`;const b=fetch(l),[s]=await Promise.all([b,c]);if(!s.ok)throw new Error("404");const w=await s.text();n.style.opacity="0",await new Promise(f=>{setTimeout(()=>{if(n.innerHTML=`<div class="wolf-page-intro">${w}</div>`,applyRoleBasedVisibility(document),a){const u=window.innerWidth<=1024,g=r[e];if(!g||e==="home")a.innerHTML="WOLF <span>PALOMAR</span> GYM",a.style.fontSize="";else{const v=u?"0.85rem":"1rem",h="0.5",S=e===g.parentRoute?`<span style="opacity: ${h};">${g.parent}</span>`:`<span class="breadcrumb-link" 
               onclick="window.pendingHubSection='${g.section}'; navigateTo('hub')" 
               style="cursor:pointer; opacity: ${h}; transition: opacity 0.2s;">
            ${g.parent}
          </span>`;a.style.fontSize=v,a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.innerHTML=`
          <div class="breadcrumb-container" style="display: flex; align-items: center; gap: ${u?"5px":"8px"};">
            ${S}
            <i class='bx bx-chevron-right' style="color: var(--wolf-red); font-size: ${u?"1.1rem":"1.3rem"}; font-weight: bold;"></i>
            <span style="letter-spacing: 1px; font-weight: 800; color: var(--breadcrumb-current-color, var(--text-main));">${g.label}</span>
          </div>
        `}}if(y&&window.wolfData?(wolfData.activeMode=e,wolfData.initLedger(e)):e==="dashboard"&&typeof window.DashboardManager!="undefined"?window.DashboardManager.init():e==="members"&&typeof MemberManager!="undefined"?MemberManager.init():(e==="management/products"||e==="products")&&typeof ProductManager!="undefined"?ProductManager.init():e==="equipments"&&typeof window.EquipmentManager!="undefined"?window.EquipmentManager.init():e==="feedback"&&typeof window.FeedbackManager!="undefined"?window.FeedbackManager.init():e==="id-maker"&&typeof window.IdMakerManager!="undefined"?window.IdMakerManager.init():e==="audit-log"&&typeof window.AuditManager!="undefined"?window.AuditManager.init():e==="settings"&&typeof window.SettingsManager!="undefined"?window.SettingsManager.init():e==="goal-center"&&typeof window.GoalCenterManager!="undefined"&&window.GoalCenterManager.init(),n.style.opacity="1",updateNavHighlights(e),window.WOLF_CURRENT_PAGE=e,window.WOLF_LAST_REQUESTED_PAGE=e,i&&e)if(wolfMainRouter){const u=`/${e}`;(String(window.location.hash||"").replace("#","")||"/")!==u&&(wolfMainRouterSyncing=!0,wolfMainRouter.navigate(u),setTimeout(()=>{wolfMainRouterSyncing=!1},0))}else window.history.pushState({page:e},"",`?p=${e}`);window.applyVersioning&&window.applyVersioning(),f()},200)})}catch(l){if(console.warn("Wolf OS: Navigation Error ->",l),!navigator.onLine||l instanceof TypeError){n.innerHTML=m,n.style.opacity="1",wolfNavInFlight=!1,wolfNavCooldownUntil=Date.now()+260,document.body.classList.remove("wolf-nav-lock");return}try{const b=await(await fetch("/404.html")).text(),w=new DOMParser().parseFromString(b,"text/html");n.innerHTML=`<div class="wolf-page-intro">
        ${((d=w.querySelector("style"))==null?void 0:d.outerHTML)||""}
        ${w.body.innerHTML}
      </div>`,n.style.opacity="1";const f=document.getElementById("display-path");f&&(f.innerText=e),document.querySelectorAll("[data-page]").forEach(u=>u.classList.remove("active"))}catch(y){a&&(a.innerHTML="WOLF <span>PALOMAR</span> GYM"),n.innerHTML=m,n.style.opacity="1"}}finally{wolfNavInFlight=!1,wolfNavCooldownUntil=Date.now()+260,document.body.classList.remove("wolf-nav-lock")}}async function loadHTML(e){const o=await fetch(e);if(!o.ok)throw new Error(`[ERR_503] Failed to fetch: ${e}`);return await o.text()}async function initUI(){themeManager.init(),initMainRouter();const e=document.getElementById("loading-screen"),o=document.getElementById("loading-overlay"),t=document.getElementById("wolf-layout"),n=document.getElementById("stars-container"),a=document.querySelector(".boot-status"),i=document.querySelector(".progress-bar-fill"),r=async()=>{try{const[c,d,l]=await Promise.all([loadHTML("/assets/components/topbar.html"),loadHTML("/assets/components/sidebar.html"),loadHTML("/assets/components/floating-nav.html")]);document.getElementById("topbar-container").innerHTML=c,document.getElementById("sidebar-container").innerHTML=d,document.getElementById("nav-container").innerHTML=l,applyRoleBasedVisibility(document),await hydrateSidebarAuthIdentity();const y=getInitialMainPage();await navigateTo(y,{updateRoute:!0}),window.applyVersioning&&window.applyVersioning()}catch(c){console.error("Wolf OS: Component Load Error:",c)}};function p(c){const d=[{progress:15,msg:"INITIALIZING CORE SYSTEMS..."},{progress:35,msg:"ESTABLISHING SUPABASE UPLINK..."},{progress:60,msg:"LOADING SECURE ENCRYPTION..."},{progress:85,msg:"SYNCING DATABASE_MEMBERS..."},{progress:100,msg:"SYSTEM READY."}];let l=0;const y=setInterval(()=>{if(l<d.length){const b=d[l];a&&(a.innerText=b.msg),i&&(i.style.width=`${b.progress}%`),l++}else clearInterval(y),c&&c()},300)}function m(){setTimeout(()=>{e&&(e.style.opacity="0"),window.wolfAudio&&window.wolfAudio.play("intro"),setTimeout(()=>{e&&(e.style.display="none"),t&&(t.style.display="block",t.offsetWidth,t.style.opacity="1"),o&&(o.classList.add("fade-out"),setTimeout(()=>o.style.display="none",100))},300)},700)}if(typeof WOLF_CONFIG!="undefined"&&WOLF_CONFIG.noLoadingScreen){e&&(e.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none"),await r(),t&&(t.style.display="block",t.style.opacity="1"),setupGlobalClickHandlers();return}console.log("Wolf OS: Cinematic Boot Initialized."),setTimeout(async()=>{n&&(n.style.display="none"),e&&(e.style.display="flex",e.classList.add("show")),setupGlobalClickHandlers(),p(()=>{m()}),await r()},1e3)}function setupGlobalClickHandlers(){if(window.wolfEventHandlersAttached)return;window.wolfEventHandlersAttached=!0;const e={nav:0,sidebar:0,dropdown:0},o=(i,r=420)=>{const p=Date.now();return(e[i]||0)>p?!1:(e[i]=p+r,!0)},t=i=>{const r=document.getElementById("moreNavBtn");r&&r.classList.toggle("sidebar-active",!!i)},n=()=>{const i=document.getElementById("wolfSidebar"),r=document.getElementById("sidebar-backdrop");if(!i)return;i.classList.remove("active"),document.body.classList.remove("sidebar-open"),r&&r.classList.remove("active");const p=document.getElementById("closeIcon"),m=i.querySelector(".version");p&&(p.className="bxf bx-caret-big-right"),m&&(m.style.display="none"),t(!1),document.querySelectorAll(".nav-dropdown").forEach(c=>c.classList.remove("open"))};document.addEventListener("click",async i=>{if(i.target.closest(".logout-btn, .logout-btn2")){i.preventDefault(),i.stopPropagation(),window.handleLogout&&window.handleLogout();return}if(i.target.closest("#btn-add-product")){i.preventDefault(),i.stopPropagation();const s=document.getElementById("product-modal-overlay");s?s.style.display="flex":alert("Add Product modal not found in DOM");return}const m=i.target.closest(".nav-dropdown > .nav-item-side");if(m){if(!o("dropdown",260))return;i.preventDefault();const s=document.getElementById("wolfSidebar"),w=m.parentElement,f=document.getElementById("closeIcon"),u=s?s.querySelector(".version"):null;s&&!s.classList.contains("active")&&(s.classList.add("active"),document.body.classList.add("sidebar-open"),t(!0)),f&&(f.className="bxf bx-caret-big-left"),u&&(u.style.display="none"),document.querySelectorAll(".nav-dropdown").forEach(g=>{g!==w&&g.classList.remove("open")}),w.classList.toggle("open"),window.wolfAudio&&window.wolfAudio.play("notif");return}const c=i.target.closest("#toggle-search-btn");if(c){const s=c.closest("#product-main-view, #member-main-view, #sales-main-view, #logbook-main-view, #main-content, .ledger-page-wrapper")||document,w=s.querySelector("#ledger-search-container"),f=s.querySelector("#ledger-main-search");if(!w||!f)return;i.preventDefault(),i.stopPropagation();const u=w.classList.toggle("active");if(c.classList.toggle("active",u),u)setTimeout(()=>f.focus(),150);else{f.value="";const g=s.querySelector("#search-clear-btn");g&&(g.style.display="none")}return}if(i.target.closest("#clear-sales-btn")){i.preventDefault(),i.stopPropagation(),window.salesManager&&typeof window.salesManager.openTrashBin=="function"?window.salesManager.openTrashBin():console.warn("Wolf OS: salesManager not available for trash modal.");return}const l=i.target.closest("[data-page]");if(l){if(!o("nav",650))return;i.preventDefault();const s=normalizeMainPage(l.getAttribute("data-page"));navigateTo(s),window.wolfData&&window.wolfData.syncNavigationUI&&window.wolfData.syncNavigationUI(s),l.closest("#wolfSidebar")&&window.innerWidth<768&&n();return}if(i.target.closest("#themeToggleBtn")){i.preventDefault(),themeManager.toggle();return}const y=document.getElementById("wolfSidebar"),b=document.getElementById("sidebar-backdrop");if(i.target.closest("#moreNavBtn")||i.target.closest("#sidebarToggle")||i.target.closest("#sidebarClose")||i.target===b){if(!o("sidebar",340)||!y)return;const s=y.classList.toggle("active");document.body.classList.toggle("sidebar-open",s),b&&b.classList.toggle("active",s),t(s);const w=document.getElementById("closeIcon"),f=y.querySelector(".version");s?(w&&(w.className="bxf bx-caret-big-left"),f&&(f.style.display="block")):(w&&(w.className="bxf bx-caret-big-right"),f&&(f.style.display="none"),document.querySelectorAll(".nav-dropdown").forEach(u=>u.classList.remove("open")))}});const a=document.getElementById("wolfSidebar");t(a==null?void 0:a.classList.contains("active")),document.addEventListener("input",i=>{if(i.target.id==="ledger-main-search"){const r=document.getElementById("search-clear-btn");r&&(r.style.display=i.target.value.length>0?"block":"none"),clearTimeout(window.searchDebounce),window.searchDebounce=setTimeout(()=>{window.wolfData&&(window.wolfData.activeMode==="sales"?window.wolfData.loadSales():window.wolfData.loadLogbook())},300)}})}document.addEventListener("DOMContentLoaded",()=>{initUI().catch(e=>console.error("System Boot Failure:",e))});
